import jenkins.model.*
import hudson.model.*
import hudson.slaves.*
import hudson.slaves.EnvironmentVariablesNodeProperty.Entry

ComputerLauncher launcher = new JNLPLauncher()
Slave slave = new DumbSlave( "{{ slave_agent_name }}",
                             "{{ slave_windows_workdir }}",
                             launcher )
slave.numExecutors = {{ slave_executors_num }}
slave.labelString = "{{ slave_windows_labels | join(" ") }}"
{% if slave_mode_exclusive %}
slave.mode = Node.Mode.EXCLUSIVE
{% else %}
slave.mode = Node.Mode.NORMAL
{% endif %}
slave.retentionStrategy = new RetentionStrategy.Always()
Jenkins.instance.addNode(slave)
print slave.getComputer().getJnlpMac()
